@model CompxERP.Models.clsRights

@*<script src="~/Scripts/jquery-1.7.1.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>*@
<!----bootstrap css---->
<link href="~/css/bootstrap.min.css" rel="stylesheet" />
<!-----favicon.ico---->
<!------custom css---->
<link rel="stylesheet" href="~/css/font-awesome.min.css"/>
<link rel="stylesheet" href="~/css/custom.css"/>
<link rel="stylesheet" href="~/css/responsive.css"/>

<script type="text/javascript" src="~/Scripts/jquery-2.2.3.js"></script>
<script type="text/javascript" src="~/Scripts/ddaccordion.js"></script>
<script type="text/javascript" src="~/Scripts/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.inputmask.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.inputmask.extensions.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.inputmask.date.extensions.js"></script>
<script type="text/javascript" src="~/Scripts/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="~/Scripts/jquery-ui-1.8.20.js"></script>
<link href="~/Scripts/jquery-ui.css" rel="stylesheet" />
<script type="text/javascript" src="~/Scripts/jquery.validate.min.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.inputmask.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.inputmask.date.extensions.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.inputmask.extensions.js"></script>

<link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-1.4.4.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>

<style>
 

</style>

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)
    {
    <div class="compex_head">
        <div class="container-fluid">
            <h2>User Setup</h2>
        </div>
    </div>
    <div class="compex_form">
        <div class="container">
            <div class="Personal_form">
                <div class="col-sm-12">
                    <div class="tab">
                        <ul class="nav nav-tabs" id="myTab">
                            <li class="active"><a data-toggle="tab" href="#tabs-1">Create User</a></li>
                            <li><a data-toggle="tab" href="#tabs-5">Define Hierarchy</a></li>
                            <li><a data-toggle="tab" id="UserList" href="#tabs-2">Change Credential</a></li>
                            <li><a data-toggle="tab" href="#tabs-3">Permission</a></li>
                            @*<li><a  data-toggle="tab"  href="#tabs-4">Setting</a></li>*@
                        </ul>
                        <div class="clerfix"></div>
                        <div class="tab-content ">
                            <div id="tabs-1" class="tab-pane fade in active">
                                <div id="UserSetup">
                                    <div class="input_popup">

                                        <div class="col-sm-12">
                                            <div class="popup-inp-box  col-sm-3 padd_l padd_5">
                                                <div class="form-group">
                                                    <label>Select User Type *</label>
                                                    @Html.DropDownList("ddlUserType", new List<SelectListItem> {  
           new SelectListItem { Text="Admin", Value="0"}, 
           new SelectListItem { Text="R.M.", Value="20"}, 
           new SelectListItem { Text="Z.M.", Value="21"}, 
           new SelectListItem { Text="G.M.", Value="22"}, 
           new SelectListItem { Text="M.D.", Value="23"}, 
           //new SelectListItem { Text="Sub Admin", Value="1"},  
           //new SelectListItem { Text="Sales", Value="10"}, 
           //new SelectListItem { Text="Support", Value="11"},  
           //new SelectListItem { Text="Development", Value="8"},  
           new SelectListItem { Text="User", Value="1"},  
           }, new { @class = "form-control" })
                                                </div>
                                            </div>
                                            <div class="popup-inp-box  col-sm-3 padd_l padd_5">
                                                <div class="form-group">
                                                    <label>User Name *</label>
                                                    <input class="form-control unset_text" id="UserNM" autocomplete="off" type="text">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12">


                                            <div class="popup-inp-box col-sm-3 padd_l padd_5">
                                                <div class="form-group">
                                                    <label>Password *</label>
                                                    <input class="form-control" id="comppass" maxlength="8" autocomplete="off" type="password">
                                                    <span style="color: RED;" class="ng-binding"></span>
                                                </div>
                                            </div>
                                            <div class="popup-inp-box col-sm-3 padd_l padd_5">

                                                <div class="form-group">
                                                    <label>Retype Password *</label>
                                                    <input class="form-control" id="comppass_1" onblur="ChkPassword();" autocomplete="off" maxlength="8" type="Password">
                                                </div>

                                            </div>



                                        </div>
                                        <div class="col-sm-12">
                                            <input id="InsUser" value="Save" class="btn-default" type="button" />
                                            <input value="Cancel" class="btn-default" type="button" data-dismiss="modal" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="tabs-2" class="tab-pane fade">
                                <div id="FRegister1">
                                    <div id="divLead"></div>
                                </div>
                            </div>
                            <div id="tabs-3" class="tab-pane fade">
                                <div class="editor-field">
                                    <div class="form-group">
                                        <label class="col-sm-1 padd_l padd_5">Menu Type</label>
                                        <div class="col-sm-2 padd_l padd_5">
                                            @Html.DropDownListFor(model => model.GrpCode, Model.lstGrpMenu, "--Select--", new { @class = "text-box single-line" })
                                        </div>
                                        <label class="col-sm-1 padd_l padd_5">User</label>
                                        <div class="col-sm-2 padd_l padd_5">
                                            @Html.DropDownListFor(model => model.menuser, Model.lstUser, "--Select--", new { @class = "text-box single-line" })
                                        </div>
                                        <div class="col-sm-2 padd_l padd_5">
                                            <input type="button" id="InsDealer" value="Show" data-dismiss="modal" class="btn btn-default" style="margin-bottom: 10px; text-align: center; margin-top: 0px;" />

                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" name="chkSelectAll" id="chkSelectAll_View" />
                                            View All</label>
                                        <label>
                                            <input type="checkbox" name="chkSelectAll" id="chkSelectAll_Add" />
                                            Add All</label>
                                        <label>
                                            <input type="checkbox" name="chkSelectAll" id="chkSelectAll_Edit" />
                                            Edit All</label>
                                        <label>
                                            <input type="checkbox" name="chkSelectAll" id="chkSelectAll_Del" />
                                            Delete All</label>
                                        @*  <button type="button" class="btnUpdate btn btn btn-danger btn-xs"><img src="../../img/eye.png" style="width:18px;"/></button>*@
                                    </div>
                                </div>

                                <div id="ShowRights" class="item_styl clearfix tablecontainer">
                                </div>

                            </div>
                            <div id="tabs-4" class="tab-pane fade">
                                <div class="editor-field">
                                    <div class="form-group">
                                        @*   <input type ="button" value ="Setting" id="InvSett" />*@
                                        <div id="dvSetting"></div>
                                    </div>
                                </div>
                            </div>
                            <div id="tabs-5" class="tab-pane fade">
                                <div class="editor-field">
                                    <div class="form-group">
                                        <div class="input_popup">

                                            <div class="col-sm-12">
                                                <div class="popup-inp-box  col-sm-3 padd_l padd_5">
                                                    <div class="form-group">
                                                        <label>Select User Type *</label>
                                                        @Html.DropDownList("ddlUserType1", new List<SelectListItem> {  
                                                       new SelectListItem { Text="Admin", Value="0"}, 
                                                       new SelectListItem { Text="M.D.", Value="23"}, 
                                                       new SelectListItem { Text="G.M.", Value="22"}, 
                                                       new SelectListItem { Text="R.M.", Value="20"}, 
                                                    }, new { @class = "form-control" })
                                                    </div>
                                                </div>
                                                <div class="popup-inp-box  col-sm-3 padd_l padd_5">
                                                    <div class="form-group">
                                                        <label>User Name *</label>

                                                        @Html.DropDownList("UseHeadID", new List<SelectListItem> { new SelectListItem { Text = "--Select--", Value = "-1" }, })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <div id="ShowUserList" class="item_styl clearfix tablecontainer">
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <input id="InsUseHier" value="Save" class="btn-default" type="button">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    }
}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        function GetGroupUser() {
            $.ajax({
                cache: false, async: false, type: "POST",
                url: "@(Url.Action("/GetGroupUser", "User"))",
                        data: { "sGroupID": $("#ddlUserType1").val() },
                        success: function (data) {
                            $("#UseHeadID").empty();
                            if (data.lstGrpUser.length > 0) {
                                { $.each(data.lstGrpUser, function () { $("#UseHeadID").append($("<option />").val(this.Value).text(this.Text)); }); }
                            }
                        }
               });
                    GetChildTypeUser();
                }
        $("#ddlUserType1").change(function () {
            GetGroupUser();
        });
        GetGroupUser();
        function GetChildTypeUser() {

            $.ajax({
                cache: false, async: false, type: "POST",
                url: "@(Url.Action("/GetChildTypeUser", "User"))",
                data: { "sHeadID": $("#UseHeadID").val(), "sTypeID": $("#ddlUserType1").val() },
                success: function (data1) {
                    debugger;
                    $("#ShowUserList").empty();
                    if (data1 != null) {
                        var $table = $('<div id="example1" class="multi_list drop_down"> <table class="table table-fixed table-bordered j_table_new table-striped"/>');
                        $table.append('<thead><tr style="ba"> <th width="7%">No</th><th width="33%">Name</th><th width="10%"></th></tr></thead>');
                        var $tbody = $('<tbody style="height:420px;"/>');
                        $.each(data1, function (i, val) {
                            var $row = $('<tr/>');
                            $row.append($('<td width=7%"/>').html(i + 1));

                            if (val.isExistsUser == '1')
                                $row.append($('<td width="10%"/>').html('<input type="checkbox" id="chkUseCheck_' + i + '" class="Right_View btn-color" checked/><input type ="hidden"  id="hdnUseCheck_' + i + '" value ="' + val.usecode + '"  /> ' + val.usename + ' - ' + val.usernm));
                            else
                                $row.append($('<td width="10%"/>').html('<input type="checkbox" id="chkUseCheck_' + i + '" class="Right_View btn-color"/><input type ="hidden"  id="hdnUseCheck_' + i + '" value ="' + val.usecode + '"  /> ' + val.usename + ' - ' + val.usernm));

                            $tbody.append($row);
                        });
                        $table.append($tbody);
                        $table.append('</div>');
                        $('#ShowUserList').html($table);
                    }
                }
            });
        }
        $("#UseHeadID").change(function () { GetChildTypeUser(); });
        $("#chkSelectAll_View").change(function () {
            $("#example1 .Right_View").prop('checked', $(this).prop("checked"));
        });
        $("#chkSelectAll_Add").change(function () {
            $("#example1 .Right_Add").prop('checked', $(this).prop("checked"));
        });
        $("#chkSelectAll_Edit").change(function () {
            $("#example1 .Right_Edit").prop('checked', $(this).prop("checked"));
        });
        $("#chkSelectAll_Del").change(function () {
            $("#example1 .Right_Del").prop('checked', $(this).prop("checked"));
        });
        $('#InsDealer').click(function () {
            debugger;

            if ($('#GrpCode').val() != '') {
                $.get("/User/GetParty", { iGroup: $('#GrpCode').val(), iUser: $('#menuser').val() }, function (data) {
                    if (data != null) {


                        var $table = $('<div id="example1" class="multi_list drop_down"> <table class="table table-fixed table-bordered j_table_new table-striped"/>');
                        $table.append('<thead><tr style="ba"> <th width="7%">No</th> <th width="33%">Menu</th> <th width="10%">View  </th> <th width="10%">Add  </th> <th width="10%">Edit </th> <th width="10%">Delete</th>  <th width="10%"></th> </tr></thead>');

                        var $tbody = $('<tbody style="height:420px;"/>');
                        var iTotal = 0;
                        var iTax = 0;
                        debugger;
                        $.each(data, function (i, val) {
                            var $row = $('<tr/>');
                            $row.append($('<td width=7%"/>').html(i + 1));

                            $row.append($('<td width="33%"/>').html(val.Menname));

                            if (val.menview == '1')
                                $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnView_' + i + '" class="Right_View btn-color" checked    />'));
                            else
                                $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnView_' + i + '" class="Right_View btn-color" />'));

                            if (val.menaddi == '1')
                                $row.append($('<td width="10%"/>').html('<input type ="checkbox"  id="btnAdd_' + i + '" class="Right_Add btn-color"  checked    />'));
                            else
                                $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnAdd_' + i + '" class="Right_Add btn-color" />'));

                            if (val.menedit == '1')
                                $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnEdit_' + i + '" class="Right_Edit btn-color"  checked    />'));
                            else
                                $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnEdit_' + i + '" class="Right_Edit btn-color"   />'));

                            if (val.mendele == '1')
                                $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnDel_' + i + '" class="Right_Del btn-color"  checked    />'));
                            else
                                $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnDel_' + i + '" class="Right_Del btn-color"  />'));

                            //if (val.menacce == '1')
                            //    $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnAcc_' + i + '" class="Right_Acc btn-color"  checked    />'));
                            //else
                            //    $row.append($('<td width="10%"/>').html('<input type ="checkbox" id="btnAcc_' + i + '" class="Right_Acc btn-color"  />'));


                            $row.append($('<td width="10%"/>').html('<button type="button" class="btnUpdate btn btn btn-danger btn-xs"><img src="../../img/eye.png" style="width:18px;"/></button> <input type ="hidden"  id="hdnCode_' + i + '" value ="' + val.mencode + '"  />'));

                            $tbody.append($row);
                        });
                        $table.append($tbody);
                        $table.append('</div>');
                        $('#ShowRights').html($table);
                    }
                });
            }
        });
        //getInvSett();

        $(document).on("click", ".Right_View", function () {
            var $row = $(this).closest("tr"),
     $tds = $row.find("td:nth-child(3)");

            if ($('#btnView_' + $row.index())[0].checked == true) {
                $('#btnAdd_' + $row.index())[0].checked = true;
                $('#btnEdit_' + $row.index())[0].checked = true;
                $('#btnDel_' + $row.index())[0].checked = true;
            }
            else {
                $('#btnAdd_' + $row.index())[0].checked = false;
                $('#btnEdit_' + $row.index())[0].checked = false;
                $('#btnDel_' + $row.index())[0].checked = false;
            }

        });


        $('#InsUser').click(function () {
            debugger;
            var iUsetType = 0;

            iUsetType = $('#ddlUserType').val();

            if ($('#compitno').val() != '') {
                $.get("/Home/spInsUser", { usename: $('#UserNM').val(), usepass: $('#comppass').val(), UserType: iUsetType }, function (data) {
                    if (data != null) {
                        if (data == 1) {
                            alert('Saved Successfully ...');
                            $('#UserNM').val('');
                            $('#comppass').val('');
                            $('#comppass_1').val('');
                            $('#ddlUserType').val('');
                        }
                        else if (data == 2) {
                            alert('User Name Already Exists ...');
                        }
                    }
                });
            }
        });
        $('#InsUseHier').click(function () {
            var iUsetType = $('#ShowUserList').val();
            debugger;
            if ($('#compitno').val() != '') {
                $.get("/Home/spInsUser", { usename: $('#UserNM').val(), usepass: $('#comppass').val(), UserType: iUsetType }, function (data) {
                    if (data != null) {
                        if (data == 1) {
                            alert('Saved Successfully ...');
                            $('#UserNM').val('');
                            $('#comppass').val('');
                            $('#comppass_1').val('');
                            $('#ddlUserType').val('');
                        }
                        else if (data == 2) {
                            alert('User Name Already Exists ...');
                        }
                    }
                });
            }
        });



        $('#UserList').click(function () {
            debugger;
            $.ajax({
                type: "GET",
                url: "@Url.Action("UserList", "User")",
                data: {},
                success: function (data) {
                    $("#divLead").html(data);
                },
                error: function () {
                    alert('Error');
                }
            });
        });

        function getInvSett() {
            debugger;
            $.ajax({
                type: "GET",
                url: "@Url.Action("InvSett", "User")",
                data: {},
                success: function (data) {
                    $("#dvSetting").html(data);
                },
                error: function () {
                    alert('Error');
                }
            });
        }


        $(document).on("click", ".btnUpdate", function () {
            debugger;

            var $row = $(this).closest("tr"),
            $tds = $row.find("td:nth-child(2)");

            $.get("/User/InsRights", { iGroup: $('#hdnCode_' + $row.index()).val(), iUser: $('#menuser').val(), View: $('#btnView_' + $row.index())[0].checked, Add: $('#btnAdd_' + $row.index())[0].checked, Del: $('#btnDel_' + $row.index())[0].checked, Acc: true, Edit: $('#btnEdit_' + $row.index())[0].checked }, function (data) {
                if (data != null) {
                    //alert(data);
                    //$row.find("td:nth-child(2)")text
                }
            });

        });

    });
</script>
